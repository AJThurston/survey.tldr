library(survey)
library(haven)
library(summarytools)
# install_github("ajdamico/lodown")
library(lodown)
yrbss_cat <-
get_catalog( "yrbss" ,
output_dir = file.path( path.expand( "~" ) , "YRBSS" ) )
yrbss_cat <- subset( yrbss_cat , year == 2019 )
yrbss_cat <- lodown( "yrbss" , yrbss_cat )
yrbss_df <- readRDS( file.path( path.expand( "~" ) , "YRBSS" , "2019 main.rds" ) )
yrbss_design <-
svydesign(
~ psu ,
strata = ~ stratum ,
data = yrbss_df ,
weights = ~ weight ,
nest = TRUE
)
yrbss_df <- readRDS( file.path( path.expand( "~" ) , "YRBSS" , "2019 main.rds" ) )
yrbss_design <-
svydesign(
~ psu ,
strata = ~ stratum ,
data = yrbss_df ,
weights = ~ weight ,
nest = TRUE
)
yrbss_design <-
update(
yrbss_design ,
q2 = q2 ,
never_rarely_wore_bike_helmet = as.numeric( qn8 == 1 ) ,
ever_smoked_marijuana = as.numeric( qn47 == 1 ) ,
ever_tried_to_quit_cigarettes = as.numeric( q36 > 2 ) ,
smoked_cigarettes_past_year = as.numeric( q36 > 1 )
)
sum( weights( yrbss_design , "sampling" ) != 0 )
svyby( ~ one , ~ ever_smoked_marijuana , yrbss_design , unwtd.count )
help(select)
colnames(yrbss_df)
print(dfSummary(yrbss_df), method = "browser")
yrbs <- yrbss_df %>%
select(., psu, stratum, weight, age, sex, race4, race7, q8, q67, q77)
library(tidyverse)
yrbs <- yrbss_df %>%
select(., psu, stratum, weight, age, sex, race4, race7, q8, q67, q77)
write.csv(yrbs, "C:\Users\AJ Thurston\Desktop\yrbs.csv")
write.csv(yrbs, "C:\\Users\\AJ Thurston\\Desktop\\yrbs.csv")
yrbss_design <-
svydesign(
ids = ~psu,
strata = ~stratum,
data = yrbs,
weights = ~ weight,
nest = TRUE
)
svyby(~q8 ,~race4 ,dsgn, svymean)
dsgn <-
svydesign(
ids = ~psu,
strata = ~stratum,
data = yrbs,
weights = ~ weight,
nest = TRUE
)
options( survey.lonely.psu = "adjust" )
svyby(~q8 ,~race4 ,dsgn, svymean)
head(ybrs)
head(yrbs)
yrbs$race <- yrbs$race4 %>%
recode_factor(.,
1 = "White",
2 = "Black",
3 = "Hispanic",
4 = "Other")
yrbs$race <- yrbs$race4 %>%
recode_factor(.,
`1` = "White",
`2` = "Black",
`3` = "Hispanic",
`4` = "Other")
head(yrbs$race)
head(yrbs)
yrbs$age <- yrbs$age %>%
recode_factor(.,
`1` = 11,
`2` = 12,
`3` = 13,
`4` = 14,
`5` = 15,
`6` = 16,
`7` = 17,
`8` = 18)
yrbs <- yrbss_df %>%
select(., psu, stratum, weight, age, sex, race4, race7, q8, q67, q77)
yrbs$sex <- yrbs$sex %>%
recode_factor(.,
`1` = "Female",
`2` = "Male")
yrbs$race <- yrbs$race %>%
recode_factor(.,
`1` = "White",
`2` = "Black",
`3` = "Hispanic",
`4` = "Other")
yrbs$age <- yrbs$age %>%
recode_factor(.,
`1` = 11,
`2` = 12,
`3` = 13,
`4` = 14,
`5` = 15,
`6` = 16,
`7` = 17,
`8` = 18)
yrbs$sex <- yrbs$sex %>%
recode_factor(.,
`1` = "Female",
`2` = "Male")
yrbs$race <- yrbs$race4 %>%
recode_factor(.,
`1` = "White",
`2` = "Black",
`3` = "Hispanic",
`4` = "Other")
yrbs$age <- yrbs$age %>%
recode_factor(.,
`1` = 11,
`2` = 12,
`3` = 13,
`4` = 14,
`5` = 15,
`6` = 16,
`7` = 17,
`8` = 18)
head(yrbs)
yrbs <- yrbss_df %>%
select(., psu, stratum, weight, age, sex, race4, race7, q8, q67, q77)
yrbs$sex <- yrbs$sex %>%
recode_factor(.,
`1` = "Female",
`2` = "Male")
yrbs$race <- yrbs$race4 %>%
recode_factor(.,
`1` = "White",
`2` = "Black",
`3` = "Hispanic",
`4` = "Other")
yrbs$age <- yrbs$age %>%
recode_factor(.,
`1` = "12 years old and younger",
`2` = "13 years old",
`3` = "14 years old",
`4` = "15 years old",
`5` = "16 years old",
`6` = "17 years old",
`7` = "18 years old or older")
yrbs$q8 <- yrbs$q8 %>%
recode_factor(.,
`1` = "Never",
`2` = "Rarely",
`3` = "Sometimes",
`4` = "Most of the time",
`5` = "Always")
yrbs$q67 <- yrbs$q67 %>%
recode_factor(.,
`1` = "Very underweight",
`2` = "Slightly underweight",
`3` = "About the right weight",
`4` = "Slightly overweight",
`5` = "Very overweight")
yrbs$q77 <- yrbs$q77 %>%
recode_factor(.,
`1` = "0 days",
`2` = "1 day",
`3` = "2 days",
`4` = "3 days",
`5` = "4 days",
`6` = "5 days",
`7` = "6 days",
`8` = "7 days")
write.csv(yrbs, "C:\\Users\\AJ Thurston\\Desktop\\yrbs.csv")
help(sample)
set.seed(12345)
yrbs <- yrbs[sample(nrow(yrbs), size= 5000), ]
yrbs <- yrbss_df %>%
select(., psu, stratum, weight, age, sex, race4, race7, q8, q67, q77)
set.seed(12345)
yrbs <- yrbs[sample(nrow(yrbs), size= 5000), ]
yrbs$sex <- yrbs$sex %>%
recode_factor(.,
`1` = "Female",
`2` = "Male")
yrbs$race <- yrbs$race4 %>%
recode_factor(.,
`1` = "White",
`2` = "Black",
`3` = "Hispanic",
`4` = "Other")
yrbs$age <- yrbs$age %>%
recode_factor(.,
`1` = "12 years old and younger",
`2` = "13 years old",
`3` = "14 years old",
`4` = "15 years old",
`5` = "16 years old",
`6` = "17 years old",
`7` = "18 years old or older")
yrbs$q8 <- yrbs$q8 %>%
recode_factor(.,
`1` = "Never",
`2` = "Rarely",
`3` = "Sometimes",
`4` = "Most of the time",
`5` = "Always")
yrbs$q67 <- yrbs$q67 %>%
recode_factor(.,
`1` = "Very underweight",
`2` = "Slightly underweight",
`3` = "About the right weight",
`4` = "Slightly overweight",
`5` = "Very overweight")
yrbs$q77 <- yrbs$q77 %>%
recode_factor(.,
`1` = "0 days",
`2` = "1 day",
`3` = "2 days",
`4` = "3 days",
`5` = "4 days",
`6` = "5 days",
`7` = "6 days",
`8` = "7 days")
head(yrbs)
write.csv(yrbs, "C:\\Users\\AJ Thurston\\Desktop\\yrbs.csv")
dsgn <-
svydesign(
ids = ~psu,
strata = ~stratum,
data = yrbs,
weights = ~ weight,
nest = TRUE
)
options( survey.lonely.psu = "adjust" )
svyby(~q8 ,~race4 ,dsgn, svymean)
svyby(~q8 ,~race4 ,dsgn, svytotal)
svyby(~q8 ,~race ,dsgn, svytotal)
df %>%
as_survey_design(ids = psu, strata = stratum, weights = weight) %>%
group_by(race, q8, .drop = FALSE) %>%
summarize(m = survey_mean(), n = unweighted(n()))
install.packages("srvyr")
library(srvyr)
df %>%
as_survey_design(ids = psu, strata = stratum, weights = weight) %>%
group_by(race, q8, .drop = FALSE) %>%
summarize(m = survey_mean(), n = unweighted(n()))
yrbs %>%
as_survey_design(ids = psu, strata = stratum, weights = weight) %>%
group_by(race, q8, .drop = FALSE) %>%
summarize(m = survey_mean(), n = unweighted(n()))
yrbs %>%
as_survey_design(ids = psu, strata = stratum, weights = weight, nest = T) %>%
group_by(race, q8, .drop = FALSE) %>%
summarize(m = survey_mean(), n = unweighted(n()))
res <- yrbs %>%
as_survey_design(ids = psu, strata = stratum, weights = weight, nest = T) %>%
group_by(race, q8, .drop = FALSE) %>%
summarize(m = survey_mean(), n = unweighted(n()))
print(res, n = Inf)
res <- yrbs %>%
as_survey_design(ids = psu, strata = stratum, weights = weight, nest = T) %>%
group_by(sex, q8, .drop = FALSE) %>%
summarize(m = survey_mean(), n = unweighted(n()))
print(res, n = Inf)
yrbs <- yrbss_df %>%
select(., psu, stratum, weight, age, sex, race4, race7, q8, q67, q77)
set.seed(12345)
yrbs <- yrbs[sample(nrow(yrbs), size= 5000), ]
yrbs$sex <- yrbs$sex %>%
recode_factor(.,
`1` = "Female",
`2` = "Male")
yrbs$race <- yrbs$race4 %>%
recode_factor(.,
`1` = "White",
`2` = "Black",
`3` = "Hispanic",
`4` = "Other")
yrbs$age <- yrbs$age %>%
recode_factor(.,
`1` = "12 years old and younger",
`2` = "13 years old",
`3` = "14 years old",
`4` = "15 years old",
`5` = "16 years old",
`6` = "17 years old",
`7` = "18 years old or older")
yrbs$q8 <- yrbs$q8 %>%
recode_factor(.,
`1` = "Rarely or Never",
`2` = "Rarely or Never",
`3` = "Sometimes",
`4` = "Most of the time",
`5` = "Always")
yrbs$q67 <- yrbs$q67 %>%
recode_factor(.,
`1` = "Very underweight",
`2` = "Slightly underweight",
`3` = "About the right weight",
`4` = "Slightly overweight",
`5` = "Very overweight")
yrbs$q77 <- yrbs$q77 %>%
recode_factor(.,
`1` = "0 days",
`2` = "1 day",
`3` = "2 days",
`4` = "3 days",
`5` = "4 days",
`6` = "5 days",
`7` = "6 days",
`8` = "7 days")
head(yrbs)
write.csv(yrbs, "C:\\Users\\AJ Thurston\\Desktop\\yrbs.csv")
dsgn <-
svydesign(
ids = ~psu,
strata = ~stratum,
data = yrbs,
weights = ~ weight,
nest = TRUE
)
options( survey.lonely.psu = "adjust" )
res <- yrbs %>%
as_survey_design(ids = psu, strata = stratum, weights = weight, nest = T) %>%
group_by(sex, q8, .drop = FALSE) %>%
summarize(m = survey_mean(), n = unweighted(n()))
print(res, n = Inf)
res <- yrbs %>%
as_survey_design(ids = psu, strata = stratum, weights = weight, nest = T) %>%
group_by(sex, q8, .drop = FALSE) %>%
summarize(m = survey_mean(), n = unweighted(n())) %>%
filter(q8 != "Rarely or Never")
print(res, n = Inf)
res <- yrbs %>%
as_survey_design(ids = psu, strata = stratum, weights = weight, nest = T) %>%
group_by(sex, q8, .drop = FALSE) %>%
summarize(m = survey_mean(), n = unweighted(n())) %>%
filter(q8 == "Rarely or Never")
print(res, n = Inf)
yrbs <- yrbss_df %>%
select(., psu, stratum, weight, age, sex, race4, race7, q8, q67, q77)
# set.seed(12345)
# yrbs <- yrbs[sample(nrow(yrbs), size= 5000), ]
yrbs$sex <- yrbs$sex %>%
recode_factor(.,
`1` = "Female",
`2` = "Male")
yrbs$race <- yrbs$race4 %>%
recode_factor(.,
`1` = "White",
`2` = "Black",
`3` = "Hispanic",
`4` = "Other")
yrbs$age <- yrbs$age %>%
recode_factor(.,
`1` = "12 years old and younger",
`2` = "13 years old",
`3` = "14 years old",
`4` = "15 years old",
`5` = "16 years old",
`6` = "17 years old",
`7` = "18 years old or older")
yrbs$q8 <- yrbs$q8 %>%
recode_factor(.,
`1` = "Rarely or Never",
`2` = "Rarely or Never",
`3` = "Sometimes",
`4` = "Most of the time",
`5` = "Always")
yrbs$q67 <- yrbs$q67 %>%
recode_factor(.,
`1` = "Very underweight",
`2` = "Slightly underweight",
`3` = "About the right weight",
`4` = "Slightly overweight",
`5` = "Very overweight")
yrbs$q77 <- yrbs$q77 %>%
recode_factor(.,
`1` = "0 days",
`2` = "1 day",
`3` = "2 days",
`4` = "3 days",
`5` = "4 days",
`6` = "5 days",
`7` = "6 days",
`8` = "7 days")
head(yrbs)
write.csv(yrbs, "C:\\Users\\AJ Thurston\\Desktop\\yrbs.csv")
dsgn <-
svydesign(
ids = ~psu,
strata = ~stratum,
data = yrbs,
weights = ~ weight,
nest = TRUE
)
options( survey.lonely.psu = "adjust" )
res <- yrbs %>%
as_survey_design(ids = psu, strata = stratum, weights = weight, nest = T) %>%
group_by(sex, q8, .drop = FALSE) %>%
summarize(m = survey_mean(), n = unweighted(n())) %>%
filter(q8 == "Rarely or Never")
print(res, n = Inf)
svyby( ~ q8 , ~ sex , dsgn , svymean , na.rm = TRUE )
